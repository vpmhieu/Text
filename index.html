<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Đọc truyện</title>
    <style>
      body {
        background-color: #0f0f0f;
        color: #bad0bd;
        max-width: 900px;
        margin: auto;
        padding: 20px;
        font-family: "Segoe UI", Roboto, Arial, sans-serif;
      }

      h2 {
        color: #b7caba;
        margin-bottom: 10px;
      }

      #content {
        background-color: #161616;
        border-radius: 8px;
        padding: 20px;
        white-space: pre-wrap;
        line-height: 1.8;
        font-size: 18px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
      }

      button {
        background-color: #222;
        color: #fff;
        border: 1px solid #444;
        border-radius: 6px;
        padding: 10px 18px;
        margin-top: 20px;
        cursor: pointer;
        font-size: 16px;
      }

      button:hover {
        background-color: #333;
      }

      button:active {
        background-color: #555;
      }
    </style>
  </head>
  <body>
    <h2 id="title"></h2>

    <div id="content">Đang tải...</div>

    <button id="nextBtn">Kế tiếp</button>

    <script>
      // ===== 1. LẤY PARAM TỪ URL =====
      const params = new URLSearchParams(window.location.search);

      let tentruyen = params.get("tentruyen") || "khauvantiendao";
      let folder = parseInt(params.get("folder")) || 1; // chương
      let chapter = parseInt(params.get("chapter")) || 1; // tập (file)

      // ===== 2. TÍNH FILE KẾ TIẾP =====
      function getNext(folder, chapter) {
        if (chapter >= 1 && chapter <= 98) {
          return { folder, chapter: chapter + 1 };
        }
        if (chapter === 99) {
          return { folder, chapter: 0 };
        }
        // chapter === 0
        return { folder: folder + 1, chapter: 1 };
      }

      // ===== 3. LOAD FILE TXT =====
      function loadContent() {
        const path = `truyenfree/${tentruyen}/${folder}/${chapter}.txt`;

        fetch(path)
          .then((res) => {
            if (!res.ok) throw new Error("404");
            return res.text();
          })
          .then((text) => {
            document.getElementById(
              "title"
            ).innerText = `Truyện: ${tentruyen} – Chương ${folder} – Tập ${chapter}`;
            document.getElementById("content").innerText = text;
            updateURL();
          })
          .catch(() => {
            document.getElementById("content").innerText =
              "❌ Không tìm thấy nội dung";
          });
      }

      // ===== 4. CẬP NHẬT URL (KHÔNG RELOAD) =====
      function updateURL() {
        history.replaceState(
          {},
          "",
          `?tentruyen=${tentruyen}&folder=${folder}&chapter=${chapter}`
        );
      }

      // ===== 5. NÚT KẾ TIẾP =====
      document.getElementById("nextBtn").onclick = () => {
        const next = getNext(folder, chapter);
        folder = next.folder;
        chapter = next.chapter;
        loadContent();
      };

      // ===== 6. LOAD BAN ĐẦU =====
      loadContent();
    </script>
  </body>
</html>
